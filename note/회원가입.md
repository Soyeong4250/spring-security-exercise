### ğŸ“Œ íšŒì› ê°€ì…

#### í”„ë¡œì íŠ¸ êµ¬ì¡°

![image-20221128132116370](./assets/image-20221128132116370.png)



#### íšŒì› UserName ì¤‘ë³µ ì²´í¬í•˜ê¸°

**UserRestController**

```java
package com.hospital.review.controller;

import com.hospital.review.domain.Response;
import com.hospital.review.domain.dto.UserDto;
import com.hospital.review.domain.dto.UserReqDto;
import com.hospital.review.domain.dto.UserResDto;
import com.hospital.review.service.UserService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@Slf4j
@RequiredArgsConstructor
@RequestMapping("/api/v1/users")
public class UserRestController {

    private final UserService userService;

    @PostMapping("/join")
    public Response<UserResDto> join(@RequestBody UserReqDto userReqDto) {
        log.info("userName : {}", userReqDto.getUserName());
        UserDto userDto = userService.join(userReqDto);
        return Response.success(new UserResDto(userDto.getUserName(), userDto.getEmail()));
    }
}
```

**Response**

```java
package com.hospital.review.domain.entity;

import lombok.AllArgsConstructor;
import lombok.Getter;

@AllArgsConstructor
@Getter
public class Response<T> {
    private String resultCode;
    private T result;

    public static Response<Void> error(String resultCode) {
        return new Response(resultCode, null);
    }

    public static <T> Response<T> success(T result) {
        return new Response("SUCCESS", result);
    }
}
```

**User**

```java
package com.hospital.review.domain.entity;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

import javax.persistence.*;

@Entity
@Builder
@NoArgsConstructor
@AllArgsConstructor
@Getter
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(unique = true)
    private String userName;
    private String password;
    private String email;
}
```

- userNameì— Unique Key ì„¤ì •ì„ í•´ì£¼ì–´ ë°ì´í„°ê°€ ì¤‘ë³µì´ ë¶ˆê°€ëŠ¥í•˜ë„ë¡ í•¨

**UserReqDto**

```java
package com.hospital.review.domain.dto;

import com.hospital.review.domain.entity.User;
import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

@Builder
@AllArgsConstructor
@NoArgsConstructor
@Getter
public class UserReqDto {
    private String userName;
    private String password;
    private String email;

    public User toEntity(String password) {
        return User.builder()
                .userName(this.userName)
                .password(password)
                .email(this.email)
                .build();
    }
}
```

**UserResDto**

```java
package com.hospital.review.domain.dto;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;

@NoArgsConstructor
@AllArgsConstructor
@Getter
public class UserResDto {
    private String userName;
    private String email;
}

```

**UserService**

```java
package com.hospital.review.service;

import com.hospital.review.domain.dto.UserDto;
import com.hospital.review.domain.dto.UserReqDto;
import com.hospital.review.domain.entity.User;
import com.hospital.review.repository.UserRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class UserService {

    private final UserRepository userRepository;

    public UserDto join(UserReqDto request) {
        userRepository.findByUserName(request.getUserName())
                .ifPresent(user -> {
                    throw new HospitalReviewAppException(ErrorCode.DUPLICATED_USER_NAME, String.format("UserName : %s", request.getUserName()));
                });

        User savedUser = userRepository.save(request.toEntity(encoder.encode(request.getPassword())));
        return UserDto.builder()
                .id(savedUser.getId())
                .userName(savedUser.getUserName())
                .email(savedUser.getEmail())
                .build();
    }
}
```

- íšŒì›ê°€ì… ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

- íšŒì›ì˜ userNameì´ ì¤‘ë³µë˜ëŠ”ì§€ ì¤‘ë³µ Checkë¥¼ ì§„í–‰

- ì¤‘ë³µë  ê²½ìš° Exceptionì´ ë°œìƒí•˜ë„ë¡ êµ¬í˜„

- `.ifPresent()` : Optional ê°ì²´ê°€ ê°’ì„ ê°€ì§€ê³  ìˆì„ ê²½ìš° ì‹¤í–‰ ê°’ì´ ìˆë‹¤ë©´ ì˜ˆì™¸ ì²˜ë¦¬

  ğŸ‘‰ ë§Œì•½ ì¤‘ë³µëœ ì´ë¦„ìœ¼ë¡œ íšŒì›ê°€ì…ì„ ì‹œë„í•œë‹¤ë©´ ì„œë²„ì—ì„œëŠ” 500ë²ˆ ì—ëŸ¬ê°€ ë°œìƒí•˜ê³  ì—ëŸ¬ì½”ë“œì™€ ìš”ì²­í•œ íšŒì›ì˜ ì´ë¦„ì„ HospitalReviewAppExceptionìœ¼ë¡œ ë„˜ê²¨ì¤Œ

![image-20221128142007204](./assets/image-20221128142007204.png)

![image-20221128141151871](./assets/image-20221128141151871.png)

ğŸ‘‰ ì´ë•Œ ì‚¬ìš©ì ì…ì¥ì—ì„œëŠ” ì–´ë–¤ ë¬¸ì œê°€ ìˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— Exception ë°œìƒ ì‹œ ë¬¸ì œê°€ ë°œìƒí•œ ì´ìœ ë¥¼ ì•Œ ìˆ˜ ìˆë„ë¡ í•´ì•¼ í•¨ ([Exception ì²˜ë¦¬ ì°¸ê³ ](./Exceptionì²˜ë¦¬.md))

- UserRepositoryë¥¼ ì´ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ì „, ResponseDtoë¥¼ Entity ê°ì²´ë¡œ ë³€í™˜í•  ë•Œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™”í•˜ì—¬ ì €ì¥ ([SpringSecurity ì°¸ê³ ](./SpringSecurity.md)) 

