### ğŸ“Œ íšŒì› ê°€ì…

---

##### í”„ë¡œì íŠ¸ êµ¬ì¡°

![image-20221128132116370](./assets/image-20221128132116370.png)

**UserRestController**

```java
package com.hospital.review.controller;

import com.hospital.review.domain.Response;
import com.hospital.review.domain.dto.UserDto;
import com.hospital.review.domain.dto.UserReqDto;
import com.hospital.review.domain.dto.UserResDto;
import com.hospital.review.service.UserService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@Slf4j
@RequiredArgsConstructor
@RequestMapping("/api/v1/users")
public class UserRestController {

    private final UserService userService;

    @PostMapping("/join")
    public Response<UserResDto> join(@RequestBody UserReqDto userReqDto) {
        log.info("userName : {}", userReqDto.getUserName());
        UserDto userDto = userService.join(userReqDto);
        return Response.success(new UserResDto(userDto.getUserName(), userDto.getEmail()));
    }
}
```

**Response**

```java
package com.hospital.review.domain.entity;

import lombok.AllArgsConstructor;
import lombok.Getter;

@AllArgsConstructor
@Getter
public class Response<T> {
    private String resultCode;
    private T result;

    private static Response<Void> error(String resultCode) {
        return new Response(resultCode, null);
    }

    public static <T> Response<T> success(T result) {
        return new Response("SUCCESS", result);
    }
}
```

**User**

```java
package com.hospital.review.domain.entity;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;

import javax.persistence.*;

@Entity
@Builder
@NoArgsConstructor
@AllArgsConstructor
@Getter
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(unique = true)
    private String userName;
    private String password;
    private String email;
}
```

- userNameì— Unique Key ì„¤ì •ì„ í•´ì£¼ì–´ ë°ì´í„°ê°€ ì¤‘ë³µì´ ë¶ˆê°€ëŠ¥í•˜ë„ë¡ í•¨

**UserReqDto**

```java
package com.hospital.review.domain.dto;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;

@AllArgsConstructor
@NoArgsConstructor
@Getter
public class UserReqDto {
    private String userName;
    private String password;
    private String email;
}
```

**UserResDto**

```java
package com.hospital.review.domain.dto;

import lombok.AllArgsConstructor;
import lombok.Getter;
import lombok.NoArgsConstructor;

@NoArgsConstructor
@AllArgsConstructor
@Getter
public class UserResDto {
    private String userName;
    private String email;
}

```

**UserService**

```java
package com.hospital.review.service;

import com.hospital.review.domain.dto.UserDto;
import com.hospital.review.domain.dto.UserReqDto;
import com.hospital.review.domain.entity.User;
import com.hospital.review.repository.UserRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class UserService {

    private final UserRepository userRepository;

    public UserDto join(UserReqDto request) {
        userRepository.findByUserName(request.getUserName())
                .ifPresent(user -> {
                    throw new RuntimeException("ì¤‘ë³µëœ íšŒì›ì´ë¦„ ì…ë‹ˆë‹¤.");
                });

        User savedUser = userRepository.save(request.toEntity());
        return UserDto.builder()
                .id(savedUser.getId())
                .userName(savedUser.getUserName())
                .email(savedUser.getEmail())
                .build();
    }
}
```

- íšŒì›ê°€ì… ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§

- íšŒì›ì˜ userNameì´ ì¤‘ë³µë˜ëŠ”ì§€ ì¤‘ë³µ Checkë¥¼ ì§„í–‰

- ì¤‘ë³µë  ê²½ìš° Exceptionì´ ë°œìƒí•˜ë„ë¡ êµ¬í˜„

- `.ifPresent()` : Optional ê°ì²´ê°€ ê°’ì„ ê°€ì§€ê³  ìˆì„ ê²½ìš° ì‹¤í–‰ ê°’ì´ ìˆë‹¤ë©´ ì˜ˆì™¸ ì²˜ë¦¬

  ğŸ‘‰ ë§Œì•½ ì¤‘ë³µëœ ì´ë¦„ìœ¼ë¡œ íšŒì›ê°€ì…ì„ ì‹œë„í•œë‹¤ë©´ RuntimeExceptionì´ ë°œìƒí•˜ì—¬ "ì¤‘ë³µëœ íšŒì›ì´ë¦„ì…ë‹ˆë‹¤."ë¼ëŠ” ë©”ì„¸ì§€ê°€ ì½˜ì†”ì— ëœ¨ê²Œ ë¨



![image-20221128141151871](./assets/image-20221128141151871.png)
